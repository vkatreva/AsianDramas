@model AsianDramas.Models.ViewModels.ReviewIndexViewModel

<h1>Reviews</h1>

@if (User.Identity.IsAuthenticated)
{
    <form method="get" class="mb-3">
        <div class="row g-2 align-items-end">
            <div class="col-md-4">
                <label class="form-label text-white">Reviewer</label>
                <input name="reviewer" value="@Model.Reviewer" class="form-control" />
            </div>

            <div class="col-md-2">
                <label class="form-label text-white">Min rating</label>
                <input type="number" min="1" max="10" name="minRating" value="@Model.MinRating" class="form-control" />
            </div>

            <div class="col-md-3">
                <label class="form-label text-white">Sort</label>
                <select name="sortOrder" class="form-control">
                    <option value="date_desc" selected="@(Model.SortOrder == "date_desc")">Newest</option>
                    <option value="date_asc" selected="@(Model.SortOrder == "date_asc")">Oldest</option>
                    <option value="rating_desc" selected="@(Model.SortOrder == "rating_desc")">Rating high</option>
                    <option value="rating_asc" selected="@(Model.SortOrder == "rating_asc")">Rating low</option>
                </select>
            </div>

            <div class="col-md-3">
                <button class="btn btn-purple w-100" type="submit">Apply</button>
            </div>
        </div>

        <input type="hidden" name="pageSize" value="@Model.PageSize" />
    </form>
}

<table class="table table-dark table-striped mt-3">
    <thead>
        <tr>
            <th>Drama</th>
            <th>User</th>
            <th>Rating</th>
            <th>Comment</th>
            <th>Date</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var r in Model.Items)
        {
            <tr>
                <td>@r.Drama?.Title</td>
                <td>@r.ReviewerName</td>
                <td>@r.Rating</td>
                <td>@r.Comment</td>
                <td>@r.CreatedAt.ToLocalTime()</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@r.Id" class="btn btn-sm btn-warning">Edit</a>
                    <a asp-action="Delete" asp-route-id="@r.Id" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (User.Identity.IsAuthenticated && Model.TotalPages > 1)
{
    <nav class="mt-4">
        <ul class="pagination">
            @for (int p = 1; p <= Model.TotalPages; p++)
            {
                <li class="page-item @(p == Model.Page ? "active" : "")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-page="@p"
                       asp-route-pageSize="@Model.PageSize"
                       asp-route-reviewer="@Model.Reviewer"
                       asp-route-minRating="@Model.MinRating"
                       asp-route-sortOrder="@Model.SortOrder">
                        @p
                    </a>
                </li>
            }
        </ul>
    </nav>
}
